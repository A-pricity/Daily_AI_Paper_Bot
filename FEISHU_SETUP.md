# é£ä¹¦æœºå™¨äººé…ç½®æŒ‡å—

## æ¦‚è¿°

é£ä¹¦æœºå™¨äººæ”¯æŒè‡ªåŠ¨é™æµæ§åˆ¶ã€é”™å³°å‘é€ç­–ç•¥å’Œè¯·æ±‚ä½“å‹ç¼©ï¼Œç¡®ä¿æ¶ˆæ¯æ¨é€ç¨³å®šã€‚

## é™æµé…ç½®

| é™æµç±»å‹ | é™åˆ¶ | è¯´æ˜ |
|----------|------|------|
| **æ¯åˆ†é’Ÿè¯·æ±‚** | 100 æ¬¡ | å•ç§Ÿæˆ·å•æœºå™¨äºº |
| **æ¯ç§’è¯·æ±‚** | 5 æ¬¡ | å•ç§Ÿæˆ·å•æœºå™¨äºº |
| **è¯·æ±‚ä½“å¤§å°** | 20 KB | ä¸¥æ ¼é™åˆ¶ |
| **é”™è¯¯ç  11232** | è§¦å‘é™æµ | è‡ªåŠ¨é‡è¯• |

## é”™å³°å‘é€ç­–ç•¥

### é«˜å³°æœŸæ—¶æ®µï¼ˆé¿å¼€ï¼‰

é£ä¹¦ç³»ç»Ÿåœ¨ä»¥ä¸‹æ—¶é—´æ®µå¯èƒ½å‡ºç°é™æµï¼š

| æ—¶é—´æ®µ | å»ºè®® |
|--------|------|
| 10:00 | âŒ é«˜å³°ï¼Œé¿å¼€ |
| 10:30 | âŒ é«˜å³°ï¼Œé¿å¼€ |
| 17:00 | âŒ é«˜å³°ï¼Œé¿å¼€ |
| 17:30 | âŒ é«˜å³°ï¼Œé¿å¼€ |

**è‡ªåŠ¨å¤„ç†**ï¼šç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹é«˜å³°æœŸï¼Œç­‰å¾… 30 ç§’åå‘é€ã€‚

### æ¨èå‘é€æ—¶é—´

- **9:00 - 9:30**ï¼ˆæ—©é«˜å³°å‰ï¼‰
- **11:00 - 16:00**ï¼ˆé¿å¼€æ•´ç‚¹ï¼‰
- **18:00 ä¹‹å**ï¼ˆæ™šé«˜å³°åï¼‰

## è¯·æ±‚ä½“ä¼˜åŒ–

### è‡ªåŠ¨å‹ç¼©

å½“æ¶ˆæ¯è¶…è¿‡ 20KB é™åˆ¶æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š
1. ç§»é™¤å¤šä½™ç©ºè¡Œ
2. ç§»é™¤åˆ†éš”ç¬¦
3. æˆªæ–­è¶…é•¿å†…å®¹
4. æ·»åŠ "å†…å®¹å·²æˆªæ–­"æç¤º

### é£ä¹¦æ ¼å¼åŒ–å™¨ä¼˜åŒ–

| é¡¹ç›® | é…ç½®å€¼ | è¯´æ˜ |
|------|---------|------|
| æ‘˜è¦é•¿åº¦ | 120 å­— | æ¯”å¾®ä¿¡æ›´çŸ­ |
| åˆ›æ–°ç‚¹é•¿åº¦ | 60 å­— | æ¯”å¾®ä¿¡æ›´çŸ­ |
| åˆ›æ–°ç‚¹æ•°é‡ | 2 ä¸ª | åªæ˜¾ç¤ºæ ¸å¿ƒ |
| è®ºæ–‡æ•°é‡ | 3 ç¯‡ | æœ€å¤šæ˜¾ç¤º |
| å…³é”®ä¿¡æ¯ | âœ… å‰ç½® | æ ‡é¢˜ã€ä½œè€…ã€é“¾æ¥ä¼˜å…ˆæ˜¾ç¤º |

## é…ç½®æ­¥éª¤

### 1. è·å–é£ä¹¦æœºå™¨äºº Webhook

1. æ‰“å¼€é£ä¹¦ç¾¤èŠ
2. ç‚¹å‡»ç¾¤è®¾ç½® â†’ æ·»åŠ æœºå™¨äºº â†’ è‡ªå®šä¹‰æœºå™¨äºº
3. è®¾ç½®æœºå™¨äººåç§°å’Œå¤´åƒ
4. å¤åˆ¶ Webhook URLï¼ˆæ ¼å¼ï¼š`https://open.feishu.cn/open-apis/bot/v2/hook/xxxxx`ï¼‰

### 2. é…ç½®ç¯å¢ƒå˜é‡

åœ¨ `.env` æ–‡ä»¶ä¸­æ·»åŠ ï¼š

```bash
FEISHU_WEBHOOK=https://open.feishu.cn/open-apis/bot/v2/hook/your_key_here
```

### 3. GitHub Actions é…ç½®

åœ¨ GitHub ä»“åº“ä¸­æ·»åŠ  Secretï¼š

1. è®¿é—®ï¼šhttps://github.com/A-pricity/Daily_AI_Paper_Bot/settings/secrets/actions
2. ç‚¹å‡» "New repository secret"
3. Name: `FEISHU_WEBHOOK`
4. Value: ä½ çš„é£ä¹¦ Webhook URL
5. ç‚¹å‡» "Add secret"

## é™æµç›‘æ§

### å®æ—¶ç›‘æ§

æ¨é€å®Œæˆåä¼šæ˜¾ç¤ºé™æµçŠ¶æ€ï¼š

```
ğŸ“Š é™æµçŠ¶æ€: {
  'requests_this_minute': 2,
  'requests_remaining': 98,
  'seconds_until_reset': 45,
  'is_peak_hour': False,
  'last_request_seconds_ago': 10
}
```

### å­—æ®µè¯´æ˜

| å­—æ®µ | è¯´æ˜ |
|------|------|
| `requests_this_minute` | å½“å‰åˆ†é’Ÿå·²å‘é€è¯·æ±‚æ•° |
| `requests_remaining` | å‰©ä½™å¯ç”¨è¯·æ±‚æ•° |
| `seconds_until_reset` | è·ç¦»é‡ç½®çš„ç§’æ•° |
| `is_peak_hour` | æ˜¯å¦åœ¨é«˜å³°æœŸ |
| `last_request_seconds_ago` | è·ç¦»ä¸Šæ¬¡è¯·æ±‚çš„ç§’æ•° |

## ä½¿ç”¨ç¤ºä¾‹

### å•ç‹¬æ¨é€

```python
from notification import FeishuNotifier

notifier = FeishuNotifier()

# å‘é€å·²æ ¼å¼åŒ–çš„æ¶ˆæ¯
success = notifier.send("## æµ‹è¯•æ¶ˆæ¯")

# æŸ¥çœ‹é™æµçŠ¶æ€
status = notifier.get_rate_limit_status()
print(status)
```

### è‡ªåŠ¨æ ¼å¼åŒ–æ¨é€

```python
from notification import FeishuNotifier
from formatters import FeishuFormatter

notifier = FeishuNotifier()
formatter = FeishuFormatter()

papers = [...]  # è®ºæ–‡åˆ—è¡¨
metadata = {'date': '2026-02-08', 'topic': 'AI ç ”ç©¶'}

# è‡ªåŠ¨æ ¼å¼åŒ–å¹¶å‘é€
success = notifier.send_report(papers, metadata, formatter)
```

## é”™è¯¯å¤„ç†

### é™æµé”™è¯¯ï¼ˆ11232ï¼‰

ç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š
1. æ£€æµ‹åˆ°é”™è¯¯ç  11232
2. ç­‰å¾… 60 ç§’
3. è‡ªåŠ¨é‡è¯•ï¼ˆæœ€å¤š 3 æ¬¡ï¼‰

### é«˜å³°æœŸå¤„ç†

ç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š
1. æ£€æµ‹å½“å‰æ—¶é—´æ˜¯å¦åœ¨é«˜å³°æœŸ
2. ç­‰å¾… 30 ç§’é¿å¼€é«˜å³°
3. ç»§ç»­å‘é€

### è¯·æ±‚ä½“è¿‡å¤§

ç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š
1. æ£€æµ‹æ¶ˆæ¯å¤§å°
2. å¦‚æœè¶…è¿‡ 20KBï¼Œè¿›è¡Œå‹ç¼©
3. æ·»åŠ "å†…å®¹å·²æˆªæ–­"æç¤º

## æœ€ä½³å®è·µ

1. **é”™å³°å‘é€**ï¼šé¿å¼€ 10:00ã€10:30ã€17:00ã€17:30
2. **ç›‘æ§é™æµ**ï¼šå®šæœŸæŸ¥çœ‹ `get_rate_limit_status()` è¾“å‡º
3. **æµ‹è¯•é…ç½®**ï¼šä½¿ç”¨ GitHub Actions çš„ "Run workflow" æ‰‹åŠ¨æµ‹è¯•
4. **åŒæ¸ é“å¤‡ä»½**ï¼šå»ºè®®åŒæ—¶é…ç½®ä¼ä¸šå¾®ä¿¡å’Œé£ä¹¦ï¼Œç¡®ä¿æ¨é€æˆåŠŸ

## æ•…éšœæ’æŸ¥

### æ¨é€å¤±è´¥

1. æ£€æŸ¥ Webhook URL æ˜¯å¦æ­£ç¡®
2. æŸ¥çœ‹é™æµçŠ¶æ€ï¼Œç¡®è®¤æœªè§¦å‘é™æµ
3. æ£€æŸ¥é£ä¹¦ç¾¤ä¸­æœºå™¨äººæ˜¯å¦è¢«ç¦ç”¨

### é™æµé¢‘ç¹

1. æ£€æŸ¥æ˜¯å¦åœ¨é«˜å³°æœŸå‘é€
2. å‡å°‘æ¨é€é¢‘ç‡
3. è€ƒè™‘é”™å³°å‘é€

### æ¶ˆæ¯ä¸å®Œæ•´

1. æ£€æŸ¥è¯·æ±‚ä½“æ˜¯å¦è¶…è¿‡ 20KB
2. æŸ¥çœ‹æ—¥å¿—ä¸­çš„"å†…å®¹å·²æˆªæ–­"æç¤º
3. å‡å°‘è®ºæ–‡æ˜¾ç¤ºæ•°é‡

## æŠ€æœ¯ç»†èŠ‚

### é™æµç®—æ³•

```python
# æ¯åˆ†é’Ÿé™æµ
if requests_this_minute >= 100:
    wait_time = 60 - elapsed_time
    time.sleep(wait_time)

# æ¯ç§’é™æµ
time_since_last = current_time - last_request_time
if time_since_last < 0.2:  # 1/5 ç§’
    time.sleep(0.2 - time_since_last)
```

### å³°å€¼æ£€æµ‹

```python
def _is_peak_hour(self) -> bool:
    now = datetime.now()
    peak_hours = [(10, 0), (10, 30), (17, 0), (17, 30)]
    for hour, minute in peak_hours:
        if now.hour == hour and abs(now.minute - minute) <= 5:
            return True
    return False
```

## ç›¸å…³æ–‡æ¡£

- [é£ä¹¦æœºå™¨äººå¼€å‘æ–‡æ¡£](https://open.feishu.cn/document/ukTMukTMukTM/ucTM5YjL3ETO24yN1ETN)
- [é£ä¹¦é™æµè¯´æ˜](https://open.feishu.cn/document/ukTMukTMukTM/uQjN3UjLxYyN1ETN)
- [é¡¹ç›®æ¶æ„æ–‡æ¡£](ARCHITECTURE.md)
